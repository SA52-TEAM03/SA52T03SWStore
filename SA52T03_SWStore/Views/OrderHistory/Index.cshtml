@model IEnumerable<SA52T03_SWStore.Models.Order>;

@{
    ViewData["Title"] = "My Purchase";
    List<Order> allOrder = new List<Order> { };

    foreach (Order item in Model)
    {
        allOrder.Add(item);
        allOrder.Sort((a, b) => a.OrderDate.CompareTo(b.OrderDate));
        allOrder.Reverse();
    }
    static string ACode(OrderDetail od, int i)
    {
        double n = od.OrderId + od.ProductId + od.Quantity + i;
        double ac1 = od.OrderId / n;
        double ac2 = od.ProductId / n;
        double ac3 = od.Quantity / n;
        for (int j = 0; j < od.OrderId; j++)
        {
            ac1 = 3.99 * ac1 * (1 - ac1);
            ac3 = 3.99 * ac3 * (1 - ac3);
        }
        for (int j = 0; j < od.ProductId; j++)
        {
            ac1 = 3.98 * ac1 * (1 - ac1);
            ac2 = 3.98 * ac2 * (1 - ac2);
        }
        for (int j = 0; j < od.Quantity; j++)
        {
            ac2 = 3.97 * ac2 * (1 - ac2);
            ac3 = 3.97 * ac3 * (1 - ac3);
        }
        string s = ac1.ToString("0.00000").Substring(2, 5) + "-" + ac2.ToString("0.00000").Substring(2, 5) + "-" + ac3.ToString("0.00000").Substring(2, 5);
        return s;
    }
}

<h3>My Purchase</h3>

<div class="input-group" style="float:right">
    <span class="glyphicon glyphicon-search"></span>
    <input type="text" class="form-control " id="filterName" placeholder="Search" />
</div>

<table class="table" width="80%" align="center" cellpadding="30" style="margin-bottom:50px; margin-top:40px;">
    @foreach (Order item in allOrder)
    {
        @foreach (OrderDetail orderdetail in item.OrderDetail)
        {
            <tr height="200px">
                <td width="40%">
                    <div style="border:0px solid #008cba; border-radius: 5px; height:180px">
                        <div align="center">
                            <p align="center"><img src="@orderdetail.Product.Image" width="80" height="80" style="margin-top:10px;"/></p>
                            <p class="card-title h5"><b style="color:#2c3e50">@orderdetail.Product.Name</b></p>
                            <p align="center" style=" font-size: 15px">@orderdetail.Product.Description</p>
                        </div>
                    </div>
                </td>

                <td>
                    <div>
                        <div class=" row">
                            <label class="col-sm-3"> Purchased On:</label>
                            <span class="col-sm-8"> @Html.DisplayFor(modelItem => item.OrderDate)</span>
                        </div>
                        <div class=" row">
                            <label class="col-sm-3"> Quantity:</label>
                            <span class="col-sm-8"> @Html.DisplayFor(modelItem => orderdetail.Quantity)</span>
                        </div>
                        <div class=" row">
                            <label class="col-sm-3"> Remaining Days:</label>
                            <span class="col-sm-8" id="RemainingDays">
                                @if (((DateTime.Now).Subtract(item.OrderDate)).Days < 365)
                                {
                                    <span>@(365-(DateTime.Now).Subtract(item.OrderDate).Days)</span>
                                }
                                else
                                {
                                    <span>0</span>
                                }
                            </span>
                        </div>
                        <div class=" row">
                            <label class="col-sm-3"> Activation Code:</label>
                            <span class="col-sm-8">
                                <select>
                                    @for (int i = 0; i < orderdetail.Quantity; i++)
                                    {
                                        <option>
                                            @ACode(orderdetail, i)
                                        </option>
                                    }
                                </select>
                            </span>
                        </div>
                        <div>
                            <a class="btn btn-link btn-outline-light col-sm-4" style="float:right" asp-action="AddToCart" asp-controller="Home" asp-route-Id="@orderdetail.Product.Id" asp-route-page="0">Order Again</a>
                        </div>
                    </div>
                </td>
            </tr>
        }
    }
</table>

<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/twitter-bootstrap/js/bootstrap.js"></script>
<script src="~/js/Orderhistory_Search.js"></script>




